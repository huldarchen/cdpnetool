# 常见问题

本章节收集了使用 cdpnetool 过程中的常见问题及解决方法。

---

## Q: 点击「连接」按钮提示连接失败？

**可能原因：**
- 浏览器未启动或 DevTools URL 错误
- 端口被占用或防火墙拦截
- Chrome 浏览器未开启远程调试

**解决方法：**
1. 优先使用「启动浏览器」按钮，让工具自动启动 Chrome
2. 检查 DevTools URL 格式是否正确（`http://localhost:端口号`）
3. 如果手动启动浏览器，确保添加了 `--remote-debugging-port=9222` 参数
4. 检查防火墙是否拦截了端口

---

## Q: 规则不生效，请求没有被拦截？

**排查步骤：**
1. 确认配置已启用（配置列表中开关打开，显示「· 运行中」）
2. 确认目标页面已附加（Targets 面板中显示「已附加」）
3. 确认规则本身已启用（规则的 `enabled` 为 true）
4. 检查匹配条件是否正确：
   - URL 条件是否匹配实际请求
   - 生命周期阶段（request/response）是否选对
5. 切换到「Events」面板查看「未匹配的请求」列表，确认请求是否被捕获

**调试技巧：**
- 先创建一个简单规则（如只匹配 URL 包含某个关键词），验证基本流程
- 使用浏览器 DevTools Network 面板查看实际请求的 URL
- 逐步添加匹配条件，缩小范围

---

## Q: 正则表达式不生效或报错？

**常见错误：**
- 转义字符使用错误（JSON 中需要双重转义）
- 正则语法错误

**解决方法：**
1. 使用在线正则测试工具（如 regex101.com）验证表达式
2. 在 JSON 中，反斜杠需要转义，例如 `\d` 要写成 `\\d`
3. 示例：匹配数字结尾的 URL
   ```json
   {"type": "urlRegex", "pattern": "/api/user/\\d+$"}
   ```

---

## Q: 修改配置后规则没有更新？

**原因：**
- 配置修改后未保存
- 配置已保存但未重新启用

**解决方法：**
1. 按 `Ctrl+S` 或 `Cmd+S` 保存配置
2. 如果配置处于启用状态，保存后会自动重载规则
3. 如果规则仍未生效，尝试关闭再重新启用配置

---

## Q: 切换附加目标后拦截停止了？

**说明：**
这是预期行为。cdpnetool 采用单 Target 模式，切换目标时会自动：
1. 分离旧目标
2. 停止拦截
3. 附加新目标

**解决方法：**
切换目标后，需要重新点击配置开关启用拦截。

---

## Q: Events 面板没有显示任何事件？

**排查步骤：**
1. 确认已连接浏览器且附加了目标
2. 确认已启用配置（拦截已开启）
3. 在浏览器中刷新页面或触发请求
4. 检查「未匹配的请求」列表，确认请求是否被捕获

如果「未匹配的请求」中有数据，说明拦截正常工作，只是规则未匹配。

---

## Q: JSON Patch 操作失败或不生效？

**常见原因：**
- JSON Path 路径错误
- 目标字段不存在
- 操作类型选择错误

**解决方法：**
1. 在 Events 面板查看实际响应体结构
2. 确认 JSON Path 格式正确（使用 `/` 分隔，数组用数字索引）
3. 使用 `add` 操作可以创建不存在的字段
4. 使用 `replace` 操作只能修改已存在的字段

**示例：**
```json
{
  "type": "patchBodyJson",
  "patches": [
    {"op": "replace", "path": "/data/user/name", "value": "newName"}
  ]
}
```

---

## Q: 导入配置文件失败？

**可能原因：**
- JSON 格式错误（缺少引号、逗号等）
- 配置版本不兼容
- 文件编码问题

**解决方法：**
1. 使用 JSON 校验工具检查格式（如 jsonlint.com）
2. 确认配置中包含必需字段（id、name、version、rules）
3. 尝试在可视化编辑器中手动创建相同规则

---

## Q: macOS 或 Linux 如何使用？

**当前状态：**
官方仅提供 Windows 安装包，macOS 和 Linux 平台理论上支持但未经完整测试。

**解决方法：**
1. 参考 [快速开始](./02-quick-start.md) 中的「从源码构建」章节
2. 需要安装 Go、Node.js 和 Wails CLI
3. 如遇到问题，欢迎通过 GitHub Issues 反馈

---

## Q: 数据存储在哪里？如何备份？

**存储位置：**
- Windows：`%APPDATA%\cdpnetool\`
- 包含 SQLite 数据库和日志文件

**备份方法：**
1. 使用「导出」功能将配置导出为 JSON 文件
2. 或直接复制数据库文件 `cdpnetool.db`

---

## Q: 支持拦截 WebSocket 吗？

当前版本暂不支持 WebSocket 拦截，仅支持 HTTP/HTTPS 请求（包括 XHR 和 Fetch）。

---

## Q: 需要安装 HTTPS 证书吗？

不需要。cdpnetool 基于 Chrome DevTools Protocol，直接控制浏览器底层，无需安装任何证书即可拦截 HTTPS 请求。

---

## Q: 遇到 Bug 如何反馈？

1. 访问 GitHub Issues：`https://github.com/xxx/cdpnetool/issues`
2. 提供以下信息：
   - 系统版本（Windows 10/11）
   - 工具版本
   - 复现步骤
   - 错误截图或日志文件（位于 `%APPDATA%\cdpnetool\logs\`）

---

## 仍有问题？

如果以上内容没有解决你的问题，可以：

- 📖 重新阅读 [快速开始](./02-quick-start.md) 确认操作流程
- 📚 查看 [规则配置参考](./03-rule-reference.md) 了解详细语法
- 💬 在 GitHub Issues 提问或查看已有讨论
